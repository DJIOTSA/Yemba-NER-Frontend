<!DOCTYPE html>
<!-- Coding By CodingNepal - www.codingnepalweb.com -->
<!-- Customized By El Mhulo - https://github.com/DJIOTSA -->
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yemba NER - Named Entity Recognition | El Mhulo</title>
    <!-- Google Fonts Link For Icons -->
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@48,400,0,0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script> -->
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/css/bootstrap.min.css">
    <!-- load EmailJs-->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <!-- load jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <style>
        .entity {
            font-weight: bold;
            position: relative;
            display: inline-block;
            margin-right: 5px;
        }

        .entity sub {
            font-size: 10px;
            color: inherit;
            padding: 5px;
        }

        .name {
            color: blue;
        }

        .title {
            color: darkorange;
        }

        .cardinal {
            color: darkred;
        }

        .ordinal {
            color: purple;
        }

        .money {
            color: green;
        }

        .distance {
            color: teal;
        }

        .location {
            color: magenta;
        }

        .city {
            color: navy;
        }

        .geopolitical {
            color: brown;
        }

        .time {
            color: darkviolet;
        }

        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 2s linear infinite;
            display: inline-block;
            margin-left: 10px;
        }

        .alert {
            padding: 15px;
            background-color: #f44336;
            /* Red */
            color: white;
            margin-bottom: 15px;
            opacity: 1;
            transition: opacity 0.6s;
            /* 600ms to fade out */
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
    </style>
</head>

<body class="container">
    <header>
        <nav class="navbar">
            <span class="hamburger-btn material-symbols-rounded">menu</span>
            <a href="index.html" class="logo">
                <img src="../images/Logo2.png" alt="logo">
                <h2 class="text-ner">Yemba NER</h2>
            </a>
            <ul class="links">
                <span class="close-btn material-symbols-rounded">close</span>
                <li><a href="index.html">Home</a></li>
                <li><a href="ner.html">NER</a></li>
                <li><a href="history.html" class="active">History</a></li>
                <li><a href="#" id="profile-link">Profile</a></li>
                <li><a href="#" id="aboutus-link">Who Are We</a></li>
                <li><a href="#" id="contact-link">Contact us</a></li>
            </ul>

            <button class="login-btn">Login</button>
        </nav>
        <!-- display  alert for feedback send status -->
        <div id="alert-container"></div>
    </header>

    <div class="blur-bg-overlay"></div>

    <!-- login and sign up popup -->
    <div class="popup" id="logreg">
        <span class="close-btn material-symbols-rounded">close</span>
        <div class="form-box login">
            <div class="form-details">
                <h2 class="text-ner" style="margin-top: 7rem;">Welcome Back</h2>
                <p>Please log in using your personal information to stay connected with us.</p>
            </div>
            <div class="form-content">
                <h2 class="important ">LOGIN</h2>
                <div class="alert-container-login"></div>
                <form id="login" action="#">
                    <div class="field email">
                        <div class="input-area">
                            <input type="text" name="email" placeholder="Email Address">
                            <i class="icon fas fa-envelope"></i>
                            <i class="error error-icon fas fa-exclamation-circle"></i>
                        </div>
                        <div class="error error-txt">Email can't be blank</div>
                    </div>
                    <div class="field password">
                        <div class="input-area">
                            <input type="password" name="password" placeholder="Password">
                            <i class="icon fas fa-lock"></i>
                            <i class="error error-icon fas fa-exclamation-circle"></i>
                        </div>
                        <div class="error error-txt">Invalid Password</div>
                    </div>
                    <a href="#" class="forgot-pass-link">Forgot password?</a>
                    <button class="cta-button" type="submit">Log In</button>
                </form>
                <div class="bottom-link">
                    Don't have an account?
                    <a href="#" id="signup-link">Signup</a>
                </div>
            </div>
        </div>
        <div class="form-box signup">
            <div class="form-details">
                <h2 class="text-ner" style="margin-top: 10rem;">Unlock the Power of Yemba</h2>
                <h6>Create Your Account Today!</h6>
                <p>Experience the future of data analysis with Yemba, our cutting-edge named entity recognition system.
                    By creating an account, you'll gain access to powerful tools that transform your data into
                    actionable insights.</p>
            </div>
            <div class="form-content">
                <h2 class="important">SIGNUP</h2>
                <div class="alert-container-signup"></div>
                <form id="register" action="">
                    <div class="field username">
                        <div class="input-area">
                            <input type="text" name="username" placeholder="Username">
                            <i class="icon fas fa-user"></i>
                            <i class="error error-icon fas fa-exclamation-circle"></i>
                        </div>
                        <div class="error error-txt">Username require at least 4 characters </div>
                    </div>
                    <div class="field email2">
                        <div class="input-area">
                            <input type="text" name="email2" placeholder="Email Address">
                            <i class="icon fas fa-envelope"></i>
                            <i class="error error-icon fas fa-exclamation-circle"></i>
                        </div>
                        <div class="error error-txt">Email can't be blank</div>
                    </div>
                    <div class="field first_name">
                        <div class="input-area">
                            <input type="text" name="first_name" placeholder="Your First Name">
                            <i class="icon fas fa-user-circle"></i>
                            <i class="error error-icon fas fa-exclamation-circle"></i>
                        </div>
                        <div class="error error-txt">First name can't be blank</div>
                    </div>
                    <div class="field last_name">
                        <div class="input-area">
                            <input type="text" name="last_name" placeholder="Your Last Name">
                            <i class="icon fas fa-user-circle"></i>
                            <i class="error error-icon fas fa-exclamation-circle"></i>
                        </div>
                        <div class="error error-txt">Last name can't be blank</div>
                    </div>
                    <div class="field password2">
                        <div class="input-area">
                            <input type="password" name="password2" placeholder="Password">
                            <i class="icon fas fa-lock"></i>
                            <i class="error error-icon fas fa-exclamation-circle"></i>
                        </div>
                        <div class="error error-txt">Password require at least 4 characters</div>
                    </div>
                    <div class="policy-text">
                        <input type="checkbox" id="policy">
                        <label for="policy">
                            I agree the
                            <a href="#" class="option">Terms & Conditions</a>
                        </label>
                    </div>
                    <button class="cta-button" type="submit">Sign Up</button>
                </form>
                <div class="bottom-link">
                    Already have an account?
                    <a href="#" id="login-link">Login</a>
                </div>
            </div>
        </div>
    </div>

    <!-- \\\\\\\\\ profile and password change (patch) ///////// -->
    <div class="popup" id="profile">
        <span class="close-btn material-symbols-rounded">close</span>
        <div class="form-box profile">
            <div class="form-details">
                <h2 class="text-ner" style="margin-top: 7rem;">Your Profile</h2>
                <p>View your personal information here.</p>
            </div>
            <div class="form-content">
                <h2 class="important">My Profile</h2>
                <div class="alert-container-profile"></div>
                <form id="profile" action="#">
                    <div class="field username3">
                        <div class="input-area">
                            <input type="text" placeholder="Username" value="current_username" disabled>
                            <i class="icon fas fa-user"></i>
                            <i class="error error-icon fas fa-exclamation-circle"></i>
                        </div>
                    </div>
                    <div class="field email3">
                        <div class="input-area">
                            <input type="text" placeholder="Email Address" value="current_email@example.com" disabled>
                            <i class="icon fas fa-envelope"></i>
                            <i class="error error-icon fas fa-exclamation-circle"></i>
                        </div>
                    </div>
                    <div class="field first_name2">
                        <div class="input-area">
                            <input type="text" name="first_name2" placeholder="Your First Name"
                                value="current_first_name" disabled>
                            <i class="icon fas fa-user-circle"></i>
                            <i class="error error-icon fas fa-exclamation-circle"></i>
                        </div>
                        <div class="error error-txt">First name can't be blank</div>
                    </div>
                    <div class="field last_name2">
                        <div class="input-area">
                            <input type="text" name="last_name2" placeholder="Your Last Name" value="current_last_name"
                                disabled>
                            <i class="icon fas fa-user-circle"></i>
                            <i class="error error-icon fas fa-exclamation-circle"></i>
                        </div>
                        <div class="error error-txt">Last name can't be blank</div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- /\\/\/\/\/\/\/\/\/\/ contact popup /\/\\/\/\/\/\/ -->
    <div class="popup" id="contact">
        <span class="close-btn material-symbols-rounded">close</span>
        <div class="form-box contact">
            <div class="form-details object-fit-sm-contain border rounded">
                <h2 style="margin-top: 7rem;">We Value Your Feedback!</h2>
                <p>Your experience matters to us. If you have any thoughts, suggestions, or concerns, please let us
                    know. Your feedback helps us improve and serve you better. Feel free to share your insights!</p>
            </div>
            <div class="form-content">
                <h2 class="important">Contact Us</h2>
                <form id="contact" action="#">
                    <div class="field textarea">
                        <textarea name="message" id="textarea-contanctus" placeholder="Your voice matters" cols="30"
                            rows="3"></textarea>
                        <div class="error error-txt">The text area is empty</div>
                    </div>
                    <div class="field emailContact">
                        <div class="input-area">
                            <input type="email" name="from_email" placeholder=" Your Email Address">
                            <div class="error error-txt">Invalid email address.</div>
                            <i class="icon fas fa-envelope"></i>
                            <i class="error error-icon fas fa-exclamation-circle"></i>
                        </div>
                    </div>
                    <button class="cta-button" type="submit">Send Feedback</button>
                </form>
            </div>
        </div>
    </div>

    <!-- /\/\/\\\/\/\/\/\/\/\/\/ aboutus /\/\/\/\/\/\/\//\/\/\ -->
    <div class="popup" id="aboutus">
        <span class="close-btn material-symbols-rounded">close</span>
        <div class="form-box aboutus">
            <div class="form-details">
                <h2 class="text-ner" style="margin-top: 7rem;">We Value Your Feedback!</h2>
                <p>Your experience matters to us. If you have any thoughts, suggestions, or concerns, please let us
                    know. Your feedback helps us improve and serve you better. Feel free to share your insights!</p>
            </div>
            <div class="form-content text-center">
                <h2 class="text-ner">About Us</h2>
                <h3 class="important">Innovative Solutions with Yemba</h3>
                <p>We're a passionate team of software engineers, transforming ideas into reality with cutting-edge
                    technology and high skill in linguistics. Meet Yemba, our advanced named entity recognition system,
                    enhancing data processing and analysis for deeper insights and better decisions. Committed to
                    quality, innovation, and collaboration, we deliver software that exceeds expectations. Join us on a
                    journey of technological excellence, powered by Yemba.</p>

            </div>
        </div>
    </div>

    <!-- /\/\/\/\/\/\/\/\/\/\/\/\ MAIN /\/\/\/\/\/\/\/\\ -->
    <main class="flex-fill container">
        <div id="history" class="main-container">
            <div class="text-white home">
                <h2 class="h1 fw-bolder mb-5">All Your Previous Works Range From The Recent To The Oldest!</h2>
                <table class="table rounded-pill">
                    <thead>
                        <tr>
                            <th scope="col">Input</th>
                            <th scope="col">Result</th>
                        </tr>
                    </thead>
                    <tbody id="history-content">

                    </tbody>
                </table>

            </div>

        </div>
    </main>

    <script src="../assets/js/emailJs.js"></script>
    <script src="../assets/js/script.js"></script>
    <script src="../assets/js/validators.js"></script>
    <script src="../assets/js/popup.js"></script>
    <script src="../assets/js/bootstrap.bundle.min.js"></script>
    <!-- fetch data history data -->
    <script>
        
        // Code to check login state and update content (assuming you're on the specific page)
        // history function
        async function fetchUserHistory() {
            const history = document.querySelector('#history');
            setInterval(()=>{
                if (!retrieveLoginState()) {
                history.querySelector('h2').innerHTML = "You must have an account to see your history.";
                history.querySelector('.table').style.display = "none";
                return;
            }
            history.querySelector('h2').innerHTML = "All Your Previous Works Range From The Recent To The Oldest!";
            history.querySelector('.table').style.display = "";
            })
            if (retrieveLoginState()) {
                
                const response = await apiRequest('https://yembaner.onrender.com/app/history/');
                if (response.ok) {
                    const data = await response.json();
                    historyContent.innerHTML = ''
                    for (element of data['results'].reverse()) {
                        let template = `<tr><td>${element['input']}</td><td>${element['output']}</td></tr>`
                        historyContent.innerHTML += template;

                    }


                } else {
                    console.log('Failed to fetch data:', response.statusText);
                }
            }

        }

        function storeLoginState(isLoggedIn) {
            localStorage.setItem('isLoggedIn', isLoggedIn); // Or use sessionStorage if needed
        }

        function retrieveLoginState() {
            const storedState = localStorage.getItem('isLoggedIn'); // Or sessionStorage
            return storedState === 'true'; // Parse the stored value
        }

        async function refreshToken() {
            const refresh_token = localStorage.getItem('refresh_token');

            if (!refresh_token) {
                document.body.classList.toggle("show-popup-logreg");
                showAlert("Please login to continue!", "login");
            }

            const response = await fetch('https://yembaner.onrender.com/user/api/token/refresh/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ refresh: refresh_token })
            });

            if (response.ok) {
                const data = await response.json();
                localStorage.setItem('access_token', data.access);
            } else {
                // Handle token refresh failure (e.g., log out the user)
                document.body.classList.toggle("show-popup-logreg");
                showAlert("Please login to continue!", "login");
            }
        }


        async function apiRequest(endpoint, options = {}) {
            const access_token = localStorage.getItem('access_token');

            if (!access_token) {
                console.error('No access token found');
                return;
            }

            const response = await fetch(endpoint, {
                ...options,
                headers: {
                    ...options.headers,
                    'Authorization': `Bearer ${access_token}`
                }
            });

            if (response.status === 401) {
                // Token might be expired, try to refresh it
                await refreshToken();

                // Retry the request with the new access token
                const newAccessToken = localStorage.getItem('access_token');
                const retryResponse = await fetch(endpoint, {
                    ...options,
                    headers: {
                        ...options.headers,
                        'Authorization': `Bearer ${newAccessToken}`
                    }
                });

                return retryResponse;
            }

            return response;
        }




        // Ensure the output visibility is toggled on page load
        document.addEventListener("DOMContentLoaded", fetchUserHistory);
    </script>
</body>

</html>